<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta
    http-equiv="Content-Security-Policy"
    content="
    default-src 'self';
    connect-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https:;
    media-src 'self' data: https:;
    frame-src 'self';
  "
  />
  <title>SummonYourWill</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="renderer/styles/scrollFix.css">
  <script type="importmap">
    {
      "imports": {
        "idb": "./node_modules/idb/build/index.js"
      }
    }
  </script>
</head>
<body class="loading">

  <div id="login-container" style="display:none;">
    <h2>Offline Version</h2>
    <button id="offline-enter-btn" class="btn btn-blue white-bold">Login</button>
    <p id="error" class="error" style="color:red"></p>
  </div>

  <div class="app">
    <div class="sidebar">
      <button data-view="home">Home</button>
      <button data-view="population">Population</button>
      <button data-view="village">Village</button>
      <button data-view="missions">Missions</button>
      <button data-view="games">Games</button>
      <button data-view="profiles" class="small-text" disabled title="Coming soon?">Social</button>
      <button data-view="tutorial">Tutorial</button>
      <button data-view="settings">Settings</button>
    </div>
      <div class="content">
        <!-- Top section with buttons and counters -->
        <div class="header">
          <button class="btn btn-blue header-button white-bold" id="export-btn">Export</button>
          <button class="btn btn-blue header-button white-bold" id="import-btn">Import</button>
          <button class="btn btn-blue header-button white-bold" id="reset-btn">Reset</button>
          <div id="resources-grid" class="resources-grid">
            <div class="res res-gold">üí∞ <strong>Gold:</strong> <span id="gold-val">0</span></div>
            <div class="res res-food">üçñ <strong>Food:</strong> <span id="food-val">0/0</span></div>
            <div class="res res-wood">ü™µ <strong>Wood:</strong> <span id="wood-val">0/0</span></div>
            <div class="res res-stone">ü™® <strong>Stone:</strong> <span id="stone-val">0/0</span></div>
          </div>
        </div>
        <div id="share-wrap" class="header-column" style="display:none;align-items:center;">
          <button class="btn btn-blue header-button white-bold" id="logout-btn-share" style="display:none;">Logout</button>
          <button class="btn btn-blue header-button white-bold" id="share-btn">Share</button>
          <div id="share-status">Private</div>
        </div>

      <section id="profiles-section" style="display:none;">
        <h1>Public Profiles</h1>
        <div class="public-profile-card card">
          <div style="display:flex;gap:6px;">
          <button class="btn btn-yellow">View Profile</button>
          <button class="btn btn-yellow">Chat</button>
          </div>
        </div>
        <div id="profiles-list"></div>
      </section>

      <section id="village-chief-section">
        <h1>Village Chief</h1>
        <div id="village-chief" class="village-chief card"></div>
      </section>

      <section id="terrain-section">
        <h1>My Terrains (1/30)</h1>
        <div id="terrain-card" class="chief-card card"></div>
        <div id="terrain-card-2" class="chief-card card"></div>
      </section>

      <section id="village-section">
        <h1>My Village</h1>
        <div id="village-overview-card" class="chief-card card"></div>
        <div id="build-house-card" class="chief-card card"></div>
        <div id="build-select-card" class="chief-card card" style="display:none;"></div>
      </section>

      <section id="special-builder-assignment" style="display:none;"></section>

      <section id="games-section" style="display:none;">
        <div id="games-card" class="chief-card card"></div>
        <h1>My Games</h1>
        <div id="games-buttons-card" class="chief-card card"></div>
      </section>
      <section id="missions-section">

        <div id="daily-missions-card" class="chief-card card" style="display:none;"></div>
        <div id="daily-missions-card-2" class="chief-card card" style="display:none;"></div>
        <h1>Missions</h1>
        <div id="missions" class="missions"></div>
        <section id="group-mission-section">
          <h2>GroupMission</h2>
          <div id="group-mission-grid"></div>
        </section>
      </section>


      
      <section id="pet-management-section" style="display:none;">
        <div id="pet-management-card" class="chief-card card"></div>
      </section>

      <section id="population-section" style="display:none;">
        <div id="population-info" style="text-align: center; margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;"></div>
        <div class="population-tabs">
          <button class="population-tab" data-population-tab="heroes">Heroes</button>
          <button class="population-tab" data-population-tab="pets">Pets</button>
        </div>
        <div id="population-content"></div>
      </section>

      <section id="productivity-section" style="display:none;">
        <h1>Productivity</h1>
        <div class="productivity-tabs">
          <button class="productivity-tab active" data-productivity-tab="life">LifeMissions</button>
          <button class="productivity-tab" data-productivity-tab="diary">Diary</button>
          <button class="productivity-tab" data-productivity-tab="weekplan">WeekPlan</button>
          <button class="productivity-tab" data-productivity-tab="habits">HabitsCalendar</button>
          <button class="productivity-tab" data-productivity-tab="projects">Projects</button>
          <button class="productivity-tab" data-productivity-tab="silence">SilenceTemple</button>
          <button class="productivity-tab" data-productivity-tab="pomodoro">PomodoroTower</button>
        </div>
        <div id="productivity-content"></div>
      </section>


      <section id="pets-section" style="display:none;">
        <h1>My Pets (0/5)</h1>
        <div class="hero-controls" id="pet-controls">
          <div class="hero-controls-row">
            <div class="control-group" data-icon="‚≠ê">
              <label><input type="checkbox" id="pet-favorite-check"> Favorites</label>
            </div>
            
            <div class="control-group" data-icon="üß≠">
              <span style="font-weight: bold; margin-right: 4px;">Order by:</span>
              <button id="pet-sort-name-btn" class="btn btn-green">Name</button>
              <button id="pet-sort-level-btn" class="btn btn-green">Level</button>
            </div>
            
            <div class="control-group" data-icon="üîç">
              <input type="text" id="pet-search" list="pet-search-list" placeholder="Search pet">
              <datalist id="pet-search-list"></datalist>
            </div>
          </div>
          
          <div class="hero-controls-row">
            <div class="control-group" data-icon="üîß">
              <span style="font-weight: bold; margin-right: 4px;">Filter by:</span>
              <select id="pet-origin-filter"></select>
              <button id="pet-remove-filter-btn" class="btn btn-green" style="display:none;">RemoveFilter</button>
            </div>
          </div>
        </div>
        <div id="pets"></div>
        <div id="pet-pagination" class="pagination"></div>
      </section>


      <section id="tutorial-section" style="display:none;">
        <h1>Tutorial</h1>
        <div id="tutorial-buttons" class="chief-card card">
          <button id="next-level-table-btn" class="btn btn-green" title="Exp needed for level">NextLevelTable</button>
          <button id="acumulated-level-table-btn" class="btn btn-green" title="Total exp needed">AcumulatedLevelTable</button>
        </div>
        <div id="next-level-table-card" class="chief-card card" style="display:none;"></div>
        <div id="acumulated-level-table-card" class="chief-card card" style="display:none;"></div>
        <div id="tutorial-info-card" class="chief-card card"><pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">1. Important Notes
1.1. Save & Music Folders: Save files are stored in ...\documents\SummonYourWillSaves; music is stored in ...\SummonYourWillMusic.

2. Characters

2.1 Village Chief
Role: The leader of your village.
Has: Abilities, Stats, and an Inventory.

2.2 Heroes (Main Characters)
Role: Primary workforce and adventurers.
Resource generation: Auto-clicking, Work / Farm / Mine / Chop, Missions.
Village building: Help construct and upgrade structures.
Each Hero has: Stats, Inventory, a Pet slot, and two Abilities.

Key Structures & Effects

Terrain: Increases max Houses (each Terrain level adds +5 Houses).

Houses: Increase max Heroes (1 Hero per House).

Pet Sanctuary: Increases max Pets.

Food/Wood/Stone Storage: Raise caps for Food, Wood, Stone.

Training Grounds: Raise max attainable stats for Heroes.

Dungeon: Generates daily Gold via Daily Tribute.

Castle: Raises level caps for Village Chief, Heroes, Partner.

2.3 Pets
Role: Assign to Heroes to enhance performance.

3. Features

3.1 Silence Temple
Modes:

4-4-6 Relaxing: Inhale 4s, hold 4s, exhale 6s.

Kapalabhati Energizing: Rapid breathing with forceful exhalations.

Nadi Balancing: Alternate-nostril breathing.
Rewards: Upgrades Familiar level after 2 minutes; also gives Gold.

3.2 Pomodoro Tower
Technique: Focus cycles of 25 or 45 minutes.
Rewards: Upgrades Village Chief ability level; also gives Gold.

3.3 Projects
Manage your real-life projects.

3.4 Habits Calendar
Daily habits ‚Üí Chief stats:
Exercise ‚Üí Strength, Study ‚Üí Intelligence, Meditation ‚Üí Mana, etc.
Rewards: Upgrades Village Chief stats; also gives Gold.

3.5 Life Missions
Daily tasks with difficulty tiers:

Easy: 400 Gold

Normal: 1000 Gold

Hard: 2500 Gold

3.6 Custom Music Player
Personalized music player for your sessions.

3.7 Hero Orders
Partner issues global orders to all Heroes: Rest, Work, Auto-click.

3.8 Export / Import / Reset

Export: Save current game data to .json for use later.

Import: Load a saved .json game.

Reset: Start fresh from level 0 with default data.

3.9 SaveAllImages (Setting)
When enabled: Saves all app images to ..\images\SummonYourWillImages.

4. Minigames

4.1 Fight Intruders
Use Village Chief and Partner abilities to repel intruders and earn Gold.

4.2 Giant Boss
6 Heroes fight a giant monster that gets stronger after each defeat.

4.3 Pet Exploration
Each Pet can collect Gold once per day with the Village Chief and Partner.

4.5 Chief Survival
Earn 1000 Gold for each level the Chief survives.


4.7 Fortune Wheel
Daily wheel to earn Gold.</pre></div>
      </section>

      <section id="settings-section" style="display:none;">
        <h1>Settings</h1>
        <div id="sound-card" class="chief-card card">
          <h2>Sound</h2>
          <input id="volume-slider" type="range" min="0" max="100">
        </div>
        <div id="save-images-card" class="chief-card card">
          <h2>SaveAllImages</h2>
          <p>All images Will be saved on users‚Ä¶/images/SummonYourWillImages. </p>
          <button id="export-images-btn" class="btn btn-yellow">Export</button>
        </div>
      </section>


    </div>
  </div>

  <script type="module">
    let offlineMode = localStorage.getItem('offlineMode') === '1';

    const initApp = async () => {
      const login = document.getElementById('login-container');
      const app = document.querySelector('.app');
      
      if (location.protocol === 'file:' && !window.isElectron) {
        document.body.innerHTML = '<p style="font-family:sans-serif;padding:20px">This application must be served over HTTP. Run <code>npm run serve</code> and open <a href="http://localhost:8080">http://localhost:8080</a>.</p>';
        return;
      }
      
      if (offlineMode) {
        if (login) login.style.display = 'none';
        if (app) app.style.display = 'flex';
        document.body.classList.remove('login-view');
        
                 try {
           // Tanto en desarrollo como en producci√≥n, script.js est√° en la ra√≠z
           const scriptPath = './script.js';
           console.log('Loading script from:', scriptPath);
           
          const { default: api } = await import(scriptPath);
         api.init();
         
         // Navegaci√≥n principal solo para botones con data-view
         document.querySelectorAll('.sidebar button[data-view]').forEach(btn => {
           btn.addEventListener('click', () => {
             api.showView(btn.dataset.view);
           });
         });
          
          console.log('App initialized successfully');
        } catch (err) {
          console.error('Failed to initialize app:', err);
          document.body.innerHTML = '<p style="font-family:sans-serif;padding:20px">Failed to load modules. Run <code>npm run serve</code> and open <a href="http://localhost:8080">http://localhost:8080</a>.</p>';
        }
      } else {
        if (app) app.style.display = 'none';
        if (login) login.style.display = 'block';
        document.body.classList.add('login-view');
      }
    };

    initApp();

    const offlineBtn = document.getElementById('offline-enter-btn');
    if (offlineBtn) {
      offlineBtn.addEventListener('click', () => {
        try { localStorage.setItem('offlineMode', '1'); } catch {}
        offlineMode = true;
        initApp();
      });
    }
  </script>
  <div id="hero-chooser-modal" class="modal hidden">
    <button class="close-btn">‚úñ</button>
    <input type="search" placeholder="Search hero" />
    <div class="hero-list"></div>
  </div>
  <div id="modal-root"></div>
</body>
</html>
