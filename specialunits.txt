================================================================================
DOCUMENTACI√ìN: BOT√ìN POPULATION - SPECIAL UNITS SYSTEM
================================================================================

UBICACI√ìN: Bot√≥n verde "Population" en la interfaz principal (script.js)

================================================================================
1. ESTRUCTURA DE DATOS
================================================================================

Existen tres tipos de unidades especiales almacenadas en:

A) ELITES (Elites.json)
   - Archivo fuente: src/Population/allelites.json (33 unidades)
   - Estructura:
     {
       "id": "string",
       "name": "string",
       "img": "Elites/nombre.png",
       "desc": "descripci√≥n de la unidad",
       "Level": number (incrementa cuando se obtiene duplicado)
     }
   - Probabilidad de obtenci√≥n: 5%
   - Color distintivo: Dorado (#ffd700)
   - Carpeta de im√°genes: src/Population/Elites/

B) SPECIAL CITIZENS (SpecialCitizens.json)
   - Archivo fuente: src/Population/allspecialcitizens.json (4 unidades)
   - Estructura:
     {
       "id": "string",
       "name": "string",
       "img": "SpecialCitizens/nombre.png",
       "desc": "descripci√≥n de la unidad",
       "Quantity": number (incrementa cuando se obtiene duplicado)
     }
   - Probabilidad de obtenci√≥n: 45%
   - Color distintivo: Plateado (#c0c0c0)
   - Carpeta de im√°genes: src/Population/SpecialCitizens/

C) SPECIAL SOLDIERS (SpecialSoldiers.json)
   - Archivo fuente: src/Population/allspecialsoldiers.json (9 unidades)
   - Estructura:
     {
       "id": "string",
       "name": "string",
       "img": "SpecialSoldiers/nombre.png",
       "desc": "descripci√≥n de la unidad",
       "Quantity": number (incrementa cuando se obtiene duplicado)
     }
   - Probabilidad de obtenci√≥n: 50%
   - Color distintivo: Plateado (#c0c0c0)
   - Carpeta de im√°genes: src/Population/SpecialSoldiers/

================================================================================
2. BOT√ìN "SUMMON SPECIAL UNITS" (5000 GOLD)
================================================================================

UBICACI√ìN EN C√ìDIGO: script.js, l√≠neas 10856-11436

CARACTER√çSTICAS:
- ID del bot√≥n: "special-units-btn"
- Texto: "üÉèSummon SpecialUnits (5000 Gold)üÉè"
- Clase CSS: "btn btn-gold"
- Tooltip: "5 Random Units (Elites/Sp.Citizen/Sp.Soldier)"
- Costo: 5000 Gold
- Ubicaci√≥n: Primera fila de botones en la tarjeta Population

FUNCIONALIDAD AL HACER CLIC:
1. Verifica si hay suficiente oro (state.money >= 5000)
2. Crea/muestra un minijuego tipo "Pack Opening" (simulador de paquete de cartas)
3. Si ya existe el minijuego, lo elimina (toggle)

================================================================================
3. MINIJUEGO "SPECIAL UNITS PACK OPENING"
================================================================================

ID DEL CONTENEDOR: "special-units-minigame"

COMPONENTES VISUALES:
- Tarjeta dorada con borde de 2px solid gold
- Fondo: #fffacd (amarillo claro)
- Header: #ffd700 (dorado) con t√≠tulo y bot√≥n de cerrar
- T√≠tulo: "üé¥ Special Units Pack Opening üé¥"

PAQUETE VISUAL:
- Dimensiones: 150px √ó 200px
- Estilo: Tarjeta dorada con estrellas ‚≠ê‚≠ê‚≠ê
- Texto: "MAGIC PACK - Contains 5 cards!"
- Efecto hover: escala a 1.05

BOT√ìN "OPEN PACK":
- Texto: "OPEN PACK (5000 Gold)"
- Clase: "btn btn-gold"
- Se deshabilita durante la apertura mostrando "OPENING..."

================================================================================
4. PROCESO DE APERTURA DEL PAQUETE
================================================================================

PASO 1: VALIDACI√ìN Y PAGO (L√≠neas 10960-10984)
- Verifica oro disponible (state.money >= 5000)
- Guarda posici√≥n de scroll para evitar saltos de p√°gina
- DEDUCE INMEDIATAMENTE 5000 gold: state.money -= 5000
- Actualiza display de recursos
- Deshabilita bot√≥n y muestra "OPENING..."

PASO 2: CARGA DE DATOS (L√≠neas 10988-10046)
- Carga archivos JSON usando Promise.all():
  * src/Population/allelites.json
  * src/Population/allspecialcitizens.json
  * src/Population/allspecialsoldiers.json
- Manejo de errores con catch(() => [])

PASO 3: GENERACI√ìN DE UNIDADES (L√≠neas 11007-11035)
- Genera exactamente 5 unidades aleatorias
- Sistema de probabilidades ponderadas:
  * random < 0.05 ‚Üí Elite (5%)
  * random < 0.5 ‚Üí Special Citizen (45%)
  * random >= 0.5 ‚Üí Special Soldier (50%)
- Cada unidad incluye tipo, nombre, descripci√≥n e imagen

PASO 4: A√ëADIR A COLECCIONES (L√≠neas 11056-11118)
A) Para ELITES:
   - Si existe: Incrementa Level
   - Si es nueva: A√±ade con Level = 1
   - Almacenado en: window.Elites[]

B) Para SPECIAL CITIZENS:
   - Si existe: Incrementa Quantity
   - Si es nueva: A√±ade con Quantity = 1
   - Almacenado en: window.SpecialCitizens[]

C) Para SPECIAL SOLDIERS:
   - Si existe: Incrementa Quantity
   - Si es nueva: A√±ade con Quantity = 1
   - Almacenado en: window.SpecialSoldiers[]

PASO 5: ACTUALIZACI√ìN DE UI (L√≠neas 11120-11156)
- Actualiza contadores en pantalla:
  * elitesCounter.textContent = `Elites: ${window.Elites.length}`
  * specialCitizensCounter.textContent = `SpecialCitizens: ${window.SpecialCitizens.length}`
  * specialSoldiersCounter.textContent = `SpecialSoldiers: ${window.SpecialSoldiers.length}`
- Llama a forceRerenderSections() para refrescar las secciones
- Llama a updatePaginatedSections() para actualizar paginaci√≥n
- Llama a updateExistingSections() para actualizar contenido
- Ejecuta saveGame() INMEDIATAMENTE

PASO 6: ANIMACI√ìN (L√≠neas 11158-11379)
- Rota el paquete 180deg (0.5s transition)
- Espera 500ms
- Oculta el paquete
- Muestra las 5 cartas en grid responsive
- Animaci√≥n de revelado escalonada (0.15s entre cartas)
- Efecto de celebraci√≥n: "üéâ PACK OPENED! üéâ"
- Re-habilita el bot√≥n despu√©s de 3 segundos

================================================================================
5. VISUALIZACI√ìN DE CARTAS (L√≠neas 11169-11316)
================================================================================

FORMATO DE CARTA:
- Dimensiones: 160px √ó 280px
- Dise√±o:
  * Tipo de unidad (esquina superior izquierda)
  * Nombre de la unidad (centrado, 48px altura)
  * Imagen (120px √ó 120px, centrada)
  * Nivel/Cantidad (solo para display, no se muestra en apertura)
  * Descripci√≥n (4 l√≠neas m√°ximo, truncado con ellipsis)

COLORES:
- Elites: Fondo dorado (#ffd700), borde #b8860b
- Otros: Fondo plateado (#c0c0c0), borde #808080

IMAGEN:
- Carga desde: src/Population/${unit.img}
- Fallback: Emoji üé¥ con fondo degradado
- Manejo de errores: onerror muestra emoji en lugar de imagen rota
- Logging: onload y onerror registran en consola

ANIMACI√ìN:
@keyframes cardReveal {
  0%: opacity 0, translateY(30px), scale(0.8), rotateX(90deg)
  50%: opacity 0.7, translateY(15px), scale(0.9), rotateX(45deg)
  100%: opacity 1, translateY(0), scale(1), rotateX(0deg)
}
- Duraci√≥n: 0.8s ease-out
- Delay escalonado: index √ó 0.15s

HOVER:
- Transform: translateY(-5px) scale(1.05)
- Box-shadow: 0 8px 16px rgba(0,0,0,0.3)
- Transition: 0.3s ease

================================================================================
6. CONTADORES DE POPULATION (L√≠neas 11470-11529)
================================================================================

UBICACI√ìN: Debajo de los botones de summon

CONTADORES MOSTRADOS:
1. Citizens: ${citizens}/${state.terrain * 50}
2. Soldiers: ${soldiers}/${state.terrain * 50}
3. Familiars: ${unlockedFamiliars}/100
4. Heroes: ${state.heroes.length}
5. Villains: ${villains.length}
6. Pets: ${totalPets}
7. Elites: ${window.Elites.length}
8. SpecialCitizens: ${window.SpecialCitizens.length}
9. SpecialSoldiers: ${window.SpecialSoldiers.length}

IDs DE ELEMENTOS:
- citizens-display
- soldiers-display
- familiars-display
- heroes-total-display
- villains-total-display
- pets-total-display
- elites-display
- special-citizens-display
- special-soldiers-display

================================================================================
7. SECCIONES PAGINADAS (L√≠neas 11543-11752)
================================================================================

FUNCI√ìN: updatePaginatedSections()
- Refresca las secciones de Elites, SpecialCitizens y SpecialSoldiers
- Dispara eventos de b√∫squeda para actualizar la paginaci√≥n
- M√©todos de actualizaci√≥n:
  1. Dispara eventos 'input' y 'change' en campos de b√∫squeda
  2. Focus/blur para activar listeners
  3. Reemplazo temporal del contenido

FUNCI√ìN: forceRerenderSections()
- Re-renderiza completamente las secciones con datos actuales
- Muestra primeros 5 items en grid de 5 columnas
- Timeout de 100ms para permitir actualizaci√≥n del DOM

SECCIONES:
1. ID: 'elites'
   - Content ID: 'elites-content'
   - Datos: window.Elites

2. ID: 'special-citizens'
   - Content ID: 'special-citizens-content'
   - Datos: window.SpecialCitizens

3. ID: 'special-soldiers'
   - Content ID: 'special-soldiers-content'
   - Datos: window.SpecialSoldiers

DISE√ëO DE TARJETAS EN SECCIONES:
- Grid: 5 columnas (repeat(5, 1fr))
- Gap: 15px
- Dimensiones: 160px √ó 280px
- Contenido:
  * Badge de tipo de unidad
  * Nombre (48px altura)
  * Imagen (120px √ó 120px)
  * Level/Quantity destacado
  * Descripci√≥n (3 l√≠neas m√°ximo)

================================================================================
8. SISTEMA DE GUARDADO (src/core/saveManager.cjs y script.js)
================================================================================

A) EN SCRIPT.JS (L√≠neas 4304-4328)
Incluye en el objeto gameState:

Elites: (Array.isArray(window.Elites) ? window.Elites : []).map(u => ({
  id: u.id ?? u.name,
  name: u.name,
  img: u.img,
  desc: u.desc,
  level_quantity: u.Level ?? 1
}))

SpecialSoldiers: (Array.isArray(window.SpecialSoldiers) ? window.SpecialSoldiers : []).map(u => ({
  id: u.id ?? u.name,
  name: u.name,
  img: u.img,
  desc: u.desc,
  level_quantity: u.Quantity ?? 1
}))

SpecialCitizens: (Array.isArray(window.SpecialCitizens) ? window.SpecialCitizens : []).map(u => ({
  id: u.id ?? u.name,
  name: u.name,
  img: u.img,
  desc: u.desc,
  level_quantity: u.Quantity ?? 1
}))

NOTA: Se usa "level_quantity" como campo compacto para guardar tanto Level como Quantity

B) EN SAVEMANGER.CJS (L√≠neas 349-424, 497-510)

FUNCI√ìN: generateElitesFile(elites)
- Convierte im√°genes a base64 usando loadImageAsDataUrl()
- Guarda en: SAVE_DIR/Elites.json
- Formato:
  {
    "id": string,
    "name": string,
    "img": path_relativo,
    "img64": data_url_base64,
    "desc": string,
    "level_quantity": number
  }

FUNCI√ìN: generateSpecialCitizensFile(specialCitizens)
- Convierte im√°genes a base64
- Guarda en: SAVE_DIR/SpecialCitizens.json
- Estructura id√©ntica a Elites

FUNCI√ìN: generateSpecialSoldiersFile(specialSoldiers)
- Convierte im√°genes a base64
- Guarda en: SAVE_DIR/SpecialSoldiers.json
- Estructura id√©ntica a Elites

FLUJO EN saveGame() (L√≠neas 497-510):
if (data.Elites && Array.isArray(data.Elites)) {
  await generateElitesFile(data.Elites);
}

if (data.SpecialSoldiers && Array.isArray(data.SpecialSoldiers)) {
  await generateSpecialSoldiersFile(data.SpecialSoldiers);
}

if (data.SpecialCitizens && Array.isArray(data.SpecialCitizens)) {
  await generateSpecialCitizensFile(data.SpecialCitizens);
}

ARCHIVOS GENERADOS:
1. save.json (con todos los datos de juego)
2. Elites.json (solo datos de elites con img64)
3. SpecialCitizens.json (solo datos de ciudadanos especiales con img64)
4. SpecialSoldiers.json (solo datos de soldados especiales con img64)

================================================================================
9. CARGA DE DATOS AL INICIO
================================================================================

Las unidades especiales se cargan desde:
- window.Elites (array global)
- window.SpecialCitizens (array global)
- window.SpecialSoldiers (array global)

Se inicializan vac√≠os si no existen:
if (!window.Elites) window.Elites = [];
if (!window.SpecialCitizens) window.SpecialCitizens = [];
if (!window.SpecialSoldiers) window.SpecialSoldiers = [];

================================================================================
10. ESTILOS CSS ADICIONALES
================================================================================

ARCHIVO: src/Population/style.css

Incluye estilos para:
- Animaciones de cartas
- Efectos de hover
- Dise√±o del simulador de packs
- Part√≠culas y efectos visuales

ARCHIVO HTML STANDALONE: src/Population/specialunitssummon.html
- Simulador independiente de apertura de packs
- Usa misma estructura pero standalone
- Para pruebas y visualizaci√≥n separada

================================================================================
11. OTROS BOTONES EN POPULATION
================================================================================

SUMMON CITIZEN (100 Gold):
- ID: "citizen-btn"
- Funci√≥n: summonCitizen()
- L√≠mite: citizens < state.terrain * 50
- Incrementa: citizens++

SUMMON SOLDIER (200 Gold):
- ID: "soldier-btn"
- Funci√≥n: summonSoldier()
- L√≠mite: soldiers < state.terrain * 50
- Incrementa: soldiers++

SPECIAL CITIZEN (300 Gold):
- ID: "special-citizen-btn"
- Deshabilitado si state.money < 300

SPECIAL SOLDIER (600 Gold):
- ID: "special-soldier-btn"
- Deshabilitado si state.money < 600

ELITE (1500 Gold):
- ID: "elite-btn"
- Deshabilitado si state.money < 1500

================================================================================
12. INTEGRACI√ìN CON updateResourcesDisplay()
================================================================================

La funci√≥n updateResourcesDisplay() (l√≠neas 4714-4743 en script.js) actualiza 
todos los botones y contadores:

- Habilita/deshabilita botones seg√∫n oro y l√≠mites
- Actualiza tooltips de "Not enough Gold"
- Refresca displays de recursos
- Se llama autom√°ticamente despu√©s de cada cambio en state.money

================================================================================
13. LISTA DE UNIDADES DISPONIBLES
================================================================================

ELITES (33 total):
1. Epic Wizard Casting
2. AirBender
3. Archer RabbitOwner
4. ArtDancer CatOwner
5. ArtDancer RopeExpert
6. ArtDancer WindWarrior
7. BudgieOwner Lancer
8. Chef & Rat Duo
9. Cyclist and Dog Duo
10. EarthBender
11. Fairy Performer
12. Father Fisherman
13. FireBender
14. GoldRanger
15. Griffindor Master
16. GroupLider Swordman
17. GymTeacher Traveler
18. HappyPrince
19. Hufflepuff Master
20. LegendaryBirds Owner
21. Magical Yoga Biology Professor
22. MagicalCard Warrior
23. Muscular FairyOddParent
24. NurseBartender CatOwner
25. Ophthalmologist Mother
26. ParakeetsOwner Ninja
27. Ravenclaw Master
28. Slytherin Master
29. Smash Master
30. SwordArtOnline Swordman
31. Tuxedo Mask
32. WaterBender SwordMan
33. Yugioh Hero

SPECIAL CITIZENS (4 total):
1. Dwarf Blacksmith
2. Dwarf Lumberjack
3. Werewolf Miner
4. Dwarf Farmer

SPECIAL SOLDIERS (9 total):
1. Dwarf FireMage
2. Dwarf Guard
3. Dwarf Healer
4. Dwarf Knight
5. Elf Archer
6. Human King Swordman
7. Princess Summoner
8. Princess SwordWoman
9. Robot Gunner

================================================================================
14. ARCHIVOS RELACIONADOS
================================================================================

C√ìDIGO PRINCIPAL:
- script.js (l√≠neas 10856-11752) - Implementaci√≥n completa
- script.js (l√≠neas 4304-4328) - Guardado en gameState
- src/core/saveManager.cjs (l√≠neas 349-510) - Guardado en archivos

DATOS:
- src/Population/allelites.json
- src/Population/allspecialcitizens.json
- src/Population/allspecialsoldiers.json

IM√ÅGENES:
- src/Population/Elites/ (33 archivos .png)
- src/Population/SpecialCitizens/ (4 archivos .png)
- src/Population/SpecialSoldiers/ (9 archivos .png)

HTML/CSS STANDALONE:
- src/Population/specialunitssummon.html
- src/Population/style.css

VISUALIZACI√ìN:
- src/Population/visualizaciones.html

OTROS:
- src/Population/0Prompt.txt
- src/Population/script.js

================================================================================
15. FLUJO COMPLETO DE USUARIO
================================================================================

1. Usuario hace clic en bot√≥n verde "Population"
2. Se muestra la tarjeta Population con todos los contadores
3. Usuario ve el bot√≥n dorado "üÉèSummon SpecialUnits (5000 Gold)üÉè"
4. Usuario hace clic en el bot√≥n (si tiene ‚â•5000 gold)
5. Aparece el minijuego con un paquete dorado
6. Usuario hace clic en "OPEN PACK (5000 Gold)"
7. Se deducen inmediatamente 5000 gold
8. Se generan 5 unidades aleatorias seg√∫n probabilidades
9. Se a√±aden a las colecciones correspondientes (o incrementan Level/Quantity)
10. Se guardan los cambios autom√°ticamente
11. El paquete se anima girando 180¬∞
12. Aparecen las 5 cartas con animaci√≥n escalonada
13. Se muestra efecto de celebraci√≥n "üéâ PACK OPENED! üéâ"
14. Usuario puede ver sus nuevas unidades en las secciones de abajo
15. Los contadores se actualizan autom√°ticamente
16. Despu√©s de 3 segundos, el bot√≥n se re-habilita para otra compra

================================================================================
FIN DE LA DOCUMENTACI√ìN
================================================================================

Autor: Sistema de documentaci√≥n autom√°tica
Fecha: Recuperaci√≥n de funcionalidad eliminada
Versi√≥n del juego: Summon Your Will

